{% extends 'base.html' %}
{% block title %}Dashboard ‚Äî Blueprint App{% endblock %}

{% block extra_head %}
<style>
/* ---- dashboard-specific styles ---- */
.user-welcome-card {
    background: linear-gradient(135deg, #1a1a2e, #0f3460);
    color: white;
    border-radius: 12px;
    padding: 28px;
    margin-bottom: 28px;
    display: flex;
    align-items: center;
    gap: 20px;
}
.user-welcome-avatar {
    width: 64px; height: 64px; border-radius: 50%;
    border: 3px solid rgba(255,255,255,0.3);
    object-fit: cover; flex-shrink: 0;
}
.user-welcome-avatar-placeholder {
    width: 64px; height: 64px; border-radius: 50%;
    border: 3px solid rgba(255,255,255,0.3);
    background: linear-gradient(135deg, #667eea, #764ba2);
    display: flex; align-items: center; justify-content: center;
    font-size: 26px; font-weight: 700; color: white; flex-shrink: 0;
}
.user-welcome-card h2 { font-size: 22px; font-weight: 600; margin-bottom: 4px; }
.user-welcome-card p  { font-size: 14px; color: rgba(255,255,255,0.65); }

.session-active-badge {
    display: inline-flex; align-items: center; gap: 6px;
    font-size: 12px; font-weight: 500;
    padding: 4px 10px; border-radius: 20px;
    background: rgba(209,250,229,0.15); color: #6ee7b7;
    margin-top: 10px;
}
.session-dot {
    width: 6px; height: 6px; background: #10b981; border-radius: 50%;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
    gap: 20px;
    margin-bottom: 28px;
}
.stat-card {
    background: white; border-radius: 12px; padding: 22px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.07);
    display: flex; align-items: flex-start; gap: 16px;
}
.stat-icon {
    width: 46px; height: 46px; border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    font-size: 21px; flex-shrink: 0;
}
.stat-icon.blue  { background: #e0e7ff; }
.stat-icon.green { background: #d1fae5; }
.stat-icon.amber { background: #fef3c7; }
.stat-icon.pink  { background: #fce7f3; }
.stat-value { font-size: 28px; font-weight: 700; color: #1a1a2e; line-height: 1; margin-bottom: 4px; }
.stat-label { font-size: 13px; color: #6b7280; font-weight: 500; }

.content-grid {
    display: grid; grid-template-columns: 2fr 1fr; gap: 24px;
}
@media (max-width: 900px) { .content-grid { grid-template-columns: 1fr; } }

.placeholder-box {
    border: 2px dashed var(--border); border-radius: 10px;
    padding: 40px; text-align: center; color: var(--text-muted); margin-top: 8px;
}
.placeholder-box .icon { font-size: 40px; margin-bottom: 12px; }
.placeholder-box p { font-size: 15px; font-weight: 500; color: var(--text-muted); }
.placeholder-box span { font-size: 13px; }

.dev-note {
    margin-top: 20px; padding: 16px;
    background: var(--card-hover); border-radius: 8px; border: 1px solid var(--border);
    font-size: 13px; color: var(--text-muted); line-height: 1.6;
}
.dev-note code {
    background: #e0e7ff; padding: 2px 6px; border-radius: 4px; font-size: 12px;
}

.quick-link {
    display: flex; align-items: center; gap: 14px;
    padding: 14px 18px; border-radius: 10px;
    text-decoration: none; color: var(--text);
    transition: all 0.2s; border: 1px solid var(--border);
    margin-bottom: 10px; background: var(--surface);
}
.quick-link:hover {
    border-color: #667eea; transform: translateX(4px);
    box-shadow: 0 2px 12px rgba(102,126,234,0.15);
}
.quick-link-icon {
    width: 38px; height: 38px; border-radius: 10px;
    background: var(--card-hover); display: flex; align-items: center;
    justify-content: center; font-size: 17px;
}
.quick-link-text { flex: 1; }
.quick-link-name { font-size: 14px; font-weight: 600; }
.quick-link-desc { font-size: 12px; color: var(--text-muted); }
.quick-link-arrow { color: var(--text-muted); font-size: 18px; }

.session-table { width: 100%; font-size: 13px; border-collapse: collapse; }
.session-table td { padding: 8px 0; border-bottom: 1px solid var(--border); }
.session-table td:first-child { color: var(--text-muted); font-weight: 500; width: 90px; }
.session-table td:last-child { color: var(--text); word-break: break-all; }
.session-table tr:last-child td { border-bottom: none; }
</style>
{% endblock %}

{% block content %}

<div class="page-header">
    <h1>Dashboard</h1>
    <p>Benvenuto nell'area riservata dell'applicazione.</p>
</div>

<!-- User welcome -->
<div class="user-welcome-card">
    {% if user.picture %}
        <img src="{{ user.picture }}" alt="{{ user.name }}" class="user-welcome-avatar">
    {% else %}
        <div class="user-welcome-avatar-placeholder">
            {{ (user.name or user.email)[0]|upper }}
        </div>
    {% endif %}
    <div>
        <h2>Ciao, {{ user.name or user.email.split('@')[0] }}!</h2>
        <p>{{ user.email }}</p>
        <div class="session-active-badge">
            <span class="session-dot"></span>
            Sessione attiva ‚Äî autenticato via SSO
        </div>
    </div>
</div>

<!-- Stats -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon blue">üë•</div>
        <div>
            <div class="stat-value">{{ stats.total_sessions }}</div>
            <div class="stat-label">Sessioni attive (totale app)</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon green">üéØ</div>
        <div>
            <div class="stat-value">{{ stats.sessions_by_user.get(user.email, 0) }}</div>
            <div class="stat-label">Le tue sessioni simultanee</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon amber">‚ö°</div>
        <div>
            <div class="stat-value">{{ stats.max_per_user }}</div>
            <div class="stat-label">Max sessioni per utente</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon pink">üåê</div>
        <div>
            <div class="stat-value">{{ stats.max_global }}</div>
            <div class="stat-label">Max sessioni globali</div>
        </div>
    </div>
</div>

<!-- Content grid -->
<div class="content-grid">

    <div class="card">
        <div class="card-title">Area di lavoro</div>
        <div class="card-subtitle">Qui l'applicazione mostrer√† i contenuti principali.</div>

        <div class="placeholder-box">
            <div class="icon">üèóÔ∏è</div>
            <p>Contenuto dell'applicazione</p>
            <span>Sostituisci questo spazio con la funzionalit√† principale della tua app.</span>
        </div>

        <div class="dev-note">
            <strong style="color:#374151;">‚ÑπÔ∏è Per i team di sviluppo:</strong>
            questa dashboard √® un placeholder. Implementa qui la logica di business
            della tua applicazione. L'autenticazione SSO √® gi√† gestita ‚Äî ogni route
            protetta usa il decorator
            <code>@sso_middleware.sso_login_required</code>.
        </div>
    </div>

    <div>
        <div class="card mb-16" style="margin-bottom:20px;">
            <div class="card-title" style="margin-bottom:16px;">Navigazione rapida</div>
            <a href="{{ url_for('reports') }}" class="quick-link">
                <div class="quick-link-icon">üìä</div>
                <div class="quick-link-text">
                    <div class="quick-link-name">Reports</div>
                    <div class="quick-link-desc">Visualizza i report</div>
                </div>
                <span class="quick-link-arrow">‚Ä∫</span>
            </a>
            <a href="{{ url_for('settings') }}" class="quick-link">
                <div class="quick-link-icon">‚öôÔ∏è</div>
                <div class="quick-link-text">
                    <div class="quick-link-name">Impostazioni</div>
                    <div class="quick-link-desc">Gestisci preferenze</div>
                </div>
                <span class="quick-link-arrow">‚Ä∫</span>
            </a>
            <a href="{{ portal_url }}" class="quick-link">
                <div class="quick-link-icon">üåê</div>
                <div class="quick-link-text">
                    <div class="quick-link-name">Portale SSO</div>
                    <div class="quick-link-desc">Torna al portale</div>
                </div>
                <span class="quick-link-arrow">‚Ä∫</span>
            </a>
        </div>

        <div class="card">
            <div class="card-title" style="margin-bottom:12px;">Dati sessione</div>
            <table class="session-table">
                <tr><td>Email</td><td>{{ user.email }}</td></tr>
                <tr><td>Nome</td><td>{{ user.name or '‚Äî' }}</td></tr>
                <tr><td>Auth at</td><td>{{ user.authenticated_at[:19] if user.authenticated_at else '‚Äî' }}</td></tr>
            </table>
        </div>
    </div>

</div>
{% endblock %}
